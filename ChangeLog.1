CHANGES
================================================
変更点 2.0 --> 2.1
================================================
-------------------------------------------------------------------------------
1998-06-18  array の near 検索のバグ (まつさんからの御指摘)
-------------------------------------------------------------------------------
テキスト "I am bad" を "-w" オプションで mkary した場合、
array で "I[near 1]m" や "I[near 1]d" で検索できてしまう。
my_sel() と sa_sel() の混同と、返り値の混乱が原因。

---------------------------------------- array-main.c (変更前) -----
    if ((er = my_sel(&suf2, arg2)) == OP_ERROR)
      return OP_ERROR;
    if(er == FAIL) return OP_FAIL;
    if ((er = sa_sel(&suf1, arg1)) == OP_ERROR)
      return OP_ERROR;
    if(er == FAIL) return OP_FAIL;
--------------------------------------------------------------------

---------------------------------------- array-main.c (変更前) -----
    if ((er = sa_sel(&suf2, arg2)) == ERROR)
      return OP_ERROR;
    if(er == FAIL) return OP_FAIL;
    if ((er = sa_sel(&suf1, arg1)) == ERROR)
      return OP_ERROR;
    if(er == FAIL) return OP_FAIL;
--------------------------------------------------------------------


-------------------------------------------------------------------------------
1998-08-22  ファイル名の変更
-------------------------------------------------------------------------------
lib/ のファイル名がはるか昔のままなので変更
  select.c --> search.c, chfile.c --> file.c


-------------------------------------------------------------------------------
1998-08-22  array ファイルまわり
-------------------------------------------------------------------------------
array ファイルを読むとき、なぜか、いちいち char * に cast してから 
long * に cast していたので、いきなり long * で cast することにした。
  変更部分
    search.c: sa_search(), sa_aryidx2txtptr(), sa_aryidx2txtidx()


-------------------------------------------------------------------------------
1998-10-16..22  記事取り出し処理
-------------------------------------------------------------------------------
記事取り出し処理を強化した。
DocIDファイルというのを利用して記事取り出し処理を高速化。
技術的な話は、以下の技術文書を参照。

  SUFARYにおける記事取り出し処理について
    http://cl.aist-nara.ac.jp/~tatuo-y/doc/sa_docid.html

  記事開始位置と終了位置からなる配列による記事取り出し処理	
    http://cl.aist-nara.ac.jp/~tatuo-y/doc/sa_docid2.html

新たな関数
  file.c:
    DID *sa_opendid(char *fn); /* since 981016 */
    void sa_closedid(DID *d);  /* since 981016 */
  search.c: 
    void sa_didsearch(DID *did, long target); /* 981016 */
    char *sa_getstr(SUFARY *ary, long from, long size); /* 981021 */
    long sa_doc_start(DID *did); /* 981022 */
    long sa_doc_size(DID *did); /* 981022 */


-------------------------------------------------------------------------------
1998-10-21  文字列取り出し関数 sa_getstr()
-------------------------------------------------------------------------------
char *sa_getstr(SUFARY *ary, long from, long size)

search.c
from 文字目から size 文字取り出す。何で今までなかったんだろう。


-------------------------------------------------------------------------------
1998-10-22  ディレクトリ構成の変更
-------------------------------------------------------------------------------
変更前： array/ doc/ kwicview/ lib/ misc/ mkary/        perl/ sass/
変更後： array/ doc/ kwicview/ lib/       mkary/ mkdid/ perl/       tools/


-------------------------------------------------------------------------------
1998-10-20..22  新作サンプルプログラム
-------------------------------------------------------------------------------
$SUFARY/tools/ 以下

acp     旧作 trie の新バージョン。common prefix を全部取って来る。
lcp     longest common prefix だけ取って来る。
gf      お手軽記事検索


-------------------------------------------------------------------------------
1998-10-22  記事取り出し処理系Perlモジュール
-------------------------------------------------------------------------------
記事取り出し処理のPerlモジュール化
$SUFARY/perl/DID/

ついでに、sa_getstr() もPerlモジュール化
$SUFARY/perl/SUFARY/

担当：中山拓也氏


-------------------------------------------------------------------------------
1998-10-22  DocIDファイル作成プログラム mkdid 完成
-------------------------------------------------------------------------------
プロトタイプはだいぶ前から動いていたんだけどね。


-------------------------------------------------------------------------------
1998-10-26  text-based array ファイルという枠組
-------------------------------------------------------------------------------
テキストの数字の羅列をバイナリに変換するプログラム(tba2ary)を用意する
ことにより、 array ファイル、DocID ファイルの作成が簡単になる。例えば、
Perl で array ファイル(ソート前のもの)が作成できる。これにより、形態素
解析を利用したインデクサの作成が可能。

text-based array (tba)ファイルの例
 --- sample.tba ---
 0
 15
 65500
 123333
 ------------------

% tba2ary < sample.tba > sample.ary
% mkary -so sample


-------------------------------------------------------------------------------
1998-10-27  対話型検索プログラム array に記事取り出し機能を付与
-------------------------------------------------------------------------------
opendid FILE_NAME
  DocIDファイルを開く
did INDEX_NUMBER
  DocIDファイルからINDEX_NUMBERを含む記事の開始位置と記事サイズを表示

--- 使用例 ---
cherry % array samptxt
opendid samptxt.did
ok
did 81
from=17 size=264
ok
--------------


-------------------------------------------------------------------------------
1998-10-28  記事取り出し処理関数の追加
-------------------------------------------------------------------------------
新たな関数
  search.c: 
    long sa_doc_no(DID *did);    /* 981028 */
      先頭から数えて何番目の記事かを返します。
      先にsa_didsearch() を行っておく必要があります。
    long sa_did_size(DID *did);  /* 981028 */
      DocIDファイルに含まれる記事数を返します。


-------------------------------------------------------------------------------
1998-11-15  mkary に日本語文字処理
-------------------------------------------------------------------------------
[-J]オプション：
  文字単位で array ファイルを作るとき、日本語文字(EUC)と'<'(タグの開始)
  以外は無視。

cherry % mkary/mkary -q README
cherry % ll README.ary 
-rw-r--r--   1 tatuo-y  is-stude     6396 Nov 14 20:26 README.ary
cherry % mkary/mkary -q -J README
cherry % ll README.ary
-rw-r--r--   1 tatuo-y  is-stude     2904 Nov 14 20:26 README.ary


-------------------------------------------------------------------------------
1998-11-15  マニュアルのプレインテキスト化
-------------------------------------------------------------------------------
SUFARYガイドの内容の内、使い方説明等の部分をプレインテキスト化しました。

doc/*.txt です。詳しくは doc/00_README を参照。

整形プログラム(txt2txt.perl)も用意しました。


-------------------------------------------------------------------------------
1998-11-15  Version 2.1 β 1 をリリース
-------------------------------------------------------------------------------
いやいや、ここまで長かったなあ。


-------------------------------------------------------------------------------
1998-12-13  get_lines() の '\0' 対策
-------------------------------------------------------------------------------
sass で、'\0' 混じりの行を最後まで表示させるための変更。

lib/search.c:get_lines()
今までは、 '\0' があるとコピーを中止しちゃってた。
  strncpy(str,ary->txtmap+i,j-i+1);   
でも、'\0' って辞書ファイルとかには結構頻繁に使うんだよね。
で、これからは '\0' を '\1' に置き換えて扱う。'\1' がテキスト中にあらわれ
ることはないだろうから。
  for(k = 0; k < j-i+1; k++){
   str[k] = *(ary->txtmap+i+k);
   if(str[k] == '\0') str[k] = '\1';
  }


-------------------------------------------------------------------------------
1998-12-23  Perl モジュールのバグ
-------------------------------------------------------------------------------
SUFARY.xs の suf_init() で、sa_reset() を用いずに昔の初期化方法を行っ
ている部分があった。SUFARY.pm の search メソッドがときどき不適切な行動
をとってしまう。ちゃんと sa_reset() を使うようにしたら解決。


-------------------------------------------------------------------------------
1998-12-28  Perl モジュールのバグ。 common_prefix メソッドでメモリリーク
-------------------------------------------------------------------------------
SUFARY.xs の suf_common_prefix_search() で、free し忘れていた。
  ------ old
  long *ret;
  ...
  ret = sa_common_prefix_search(ary,key,sep);
  ------
  ------ new
  static long *ret = NULL;
  ...
  free(ret);
  ret = sa_common_prefix_search(ary,key,sep);
  ------


-------------------------------------------------------------------------------
1998-12-30  search.c::sa_search() の base_offset の扱いを変更
-------------------------------------------------------------------------------
eresult sa_search(SUFARY *ary, char *s, int keylen, int base_offset)

今までは、「...DEF」(最初の３文字は何でも良い) で offset 検索するとき
は、以下のように指定していた。

s           = ABCDEFG\0
keylen      = 7
base_offset = 3

これからは以下のように指定する。

s           = DEFG\0
keylen      = 4
base_offset = 3

今まで：   if(sa_search(ary, s, 8, 3) == CONT){ ... }
これから： if(sa_search(ary, s+3, 5, 3) == CONT){ ... }

疑似トライでの利用に便利。文字列の複製の必要が無くなる。この変更にとも
ない、search.c::sa_common_prefix_search() の該当部分を修正した。

※ sa_search() はマニュアルが不親切だから誰も使っていないとは思うけど、
   もし使ってる方がおられたら、申し訳ございません。


-------------------------------------------------------------------------------
1999-01-03  Version 2.1 β 2 をリリース
-------------------------------------------------------------------------------
β 1 のバグフィックス版といった感じです。


-------------------------------------------------------------------------------
1999-02-07  IISA
-------------------------------------------------------------------------------
ディレクトリ contrib を作って、 IISA を収録。

IISA (あいあいさ) は SUFARY を用いて複数のファイルを全文検索するための
汎用ツールで、アルゴリズムとして転置インデックス法を採用しています。
Webページの検索，メールの検索，ネットニュースの検索等に利用できます。

いんちきサーバプログラム pserv も収録。


-------------------------------------------------------------------------------
1999-06-14  mkary
-------------------------------------------------------------------------------

2月ごろ作った分割＆マージ方式による array ファイルソート機能を
mkary を正式に組み込む。

メモリに対して array ファイルが巨大になるとスラッシングによりいつまで
たってもソートが終わらないことがあります。このようなときは、mkary の
-b オプションで分割数を指定すれば、分割された小さいブロック内だけでソー
トし、最後にマージしてくれます。かなり高速にソートを行うことができます。


-------------------------------------------------------------------------------
1999-06-29  SUFARYガイドを大幅加筆
-------------------------------------------------------------------------------

SUFARYガイドを大幅加筆改訂。新たに足した内容は...
 * チュートリアル
 * インデックスファイルの構造(フォーマット)の解説
 * 自由にインデキシングする方法
 * 記事単位検索の仕組み

1999-06-28 に開催された「SUFARY講習会〜入門篇〜」で使用し、バグ出し(?)
を行った。

